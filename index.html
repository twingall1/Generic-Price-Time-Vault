<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <title>Price + Time Vaults (PLS / pDAI / HEX)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #050815;
      --text: #f3f4f6;
      --subtext: #9ca3af;
      --card-bg: #0b1020;
      --border: #1e2638;
      --accent: #16a34a;
      --accent-hover: #1fc556;
      --input-bg: #020617;
      --input-border: #4b5563;
      --status-ok: #4ade80;
      --status-warn: #facc15;
      --status-bad: #f87171;
      --fee: #ef4444;
      --copy-bg: #1e40af;
      --copy-bg-hover: #1d4ed8;
      --min-btn: #facc15;
      --min-btn-hover: #fbbf24;
    }

    body.light-theme {
      --bg: #f5f9ff;
      --text: #1a1a1a;
      --subtext: #466078;
      --card-bg: #ffffff;
      --border: #d0e0f0;
      --accent: #16a34a;
      --accent-hover: #0059cc;
      --input-bg: #ffffff;
      --input-border: #b2c8dd;
      --status-ok: #007f3b;
      --status-warn: #b38600;
      --status-bad: #c62828;
      --fee: #c62828;
      --copy-bg: #1f7aec;
      --copy-bg-hover: #0059cc;
      --min-btn: #eab308;
      --min-btn-hover: #ca8a04;
    }

    /* =======================
       GENERAL LAYOUT
       ======================= */

    body {
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 16px;
      overflow-x: hidden;
    }

    h1, h2 {
      margin-top: 0;
      margin-bottom: 6px;
      font-size: 18px;
      line-height: 1.2;
      color: var(--text);
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 12px 14px;
      margin-bottom: 6px;
      border: 1px solid var(--border);
      box-shadow: 0 6px 16px rgba(0,0,0,0.25);
      transition: transform 0.2s ease, opacity 0.2s ease;
      overflow-x: hidden;
    }

    input, button, select {
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text);
      font-size: 14px;
    }

    button { cursor: pointer; border: none; background: var(--accent); color: white; font-weight: 600; }
    button:hover { background: var(--accent-hover); }
    button[disabled] { opacity: 0.5; cursor: not-allowed; }

    .small { font-size: 12px; color: var(--subtext); }

    /* =======================
       HEADER
       ======================= */

    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .header-left { display: flex; align-items: center; gap: 14px; }
    .header-logo { height: 68px; width: auto; }

    .header-title-block > div:first-child { font-size: 24px; font-weight: 700; }
    .header-subtitle { font-size: 15px; margin-top: 3px; }

    .header-tabs {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      flex: 1;
    }

    .header-tab { font-size: 16px; font-weight: 600; color: #9ca3af; padding: 4px 10px; border-radius: 6px; }
    .header-tab:hover { color: #60a5fa; }
    .active-header-tab { color: white; background: #1e3a8a; border: 1px solid #3b82f6; }

    /* =======================
       GRID
       ======================= */

    .three-col-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 16px;
    }

    @media (max-width: 1100px) {
      .three-col-grid { grid-template-columns: 1fr; }
    }

    /* =======================
       VAULT CARDS â€” DESKTOP
       ======================= */

    .vault-card { transition: 0.15s; }
    .vault-card.collapsed .vault-body { display: none; }

    .vault-header {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      white-space: normal;
    }

    .vault-body {
      display: inline-flex;
      align-items: flex-start;
      gap: 24px;
      width: 100%;
    }

    .vault-col-main { display: flex; flex-direction: column; gap: 2px; }
    .vault-col-buttons { display: flex; flex-direction: column; gap: 6px; margin-top: 11px; }
    .vault-col-pie { display: flex; flex-direction: column; align-items: center; gap: 4px; }
    .vault-col-time { white-space: nowrap; }
    .vault-col-feeds { min-width: 200px; margin-top: 11px; }

    /* Restore ORIGINAL desktop address width */
    @media (min-width:701px) {
      .vault-header input[type="text"] {
        width: 360px !important;
        max-width: 360px !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
      }

      /* Remove mobile wrapper on desktop */
      .vault-mobile-row { display: contents !important; }

      /* Return pie + time side-by-side */
      .vault-col-pie, .vault-col-time {
        width: auto !important;
        max-width: none !important;
        flex: 0 0 auto !important;
      }
    }

    /* =======================
       MOBILE VAULT LAYOUT
       ======================= */

    @media (max-width:700px) {

      .vault-card { display:flex; flex-direction:column; gap:14px; }

      .vault-header { flex-direction:column; gap:8px; width:100%; }

      .vault-header-toprow {
        display:flex;
        flex-direction:row;
        align-items:center;
        gap:10px;
        width:100%;
      }

      .vault-header-bottomrow {
        display:flex;
        flex-direction:row;
        align-items:center;
        justify-content:space-between;
        gap:10px;
        width:100%;
      }

      .vault-header-bottomrow input[type="text"] {
        width:40% !important;
        max-width:40% !important;
        white-space:normal;
        overflow-wrap:anywhere;
      }

      .vault-header-icons { display:flex; gap:10px; }

      .vault-body {
        display:flex !important;
        flex-direction:column !important;
        gap:18px;
      }

      .vault-col-buttons {
        flex-direction:row !important;
        justify-content:space-between !important;
        width:100%;
      }

      .vault-col-buttons button { flex:1; }

      .vault-mobile-row {
        display:flex;
        flex-direction:row;
        justify-content:space-between;
        gap:14px;
        width:100%;
      }

      .vault-col-pie, .vault-col-time {
        width:50% !important;
        text-align:center;
      }

      /* ========================================
         MOBILE ZOOM (Option A - IDs)
         ======================================== */

      #card-create,
      #card-pricefeed,
      #card-about {
        transform: scale(0.92);
        transform-origin: top center;
        width: 108%;
      }
    }

  </style>
</head>
<body>

  <header class="header-row">
    <div class="header-left">
      <img src="PulseChainLogoTransparent.png" alt="PLS" class="header-logo">
      <div class="header-title-block">
        <div><b>Price + Time Vaults (PLS / pDAI / HEX)</b></div>
        <div class="header-subtitle small">
          Discipline vaults with price-mediated unlock & time backup
        </div>
      </div>
    </div>

    <div class="header-tabs">
      <a href="#" class="header-tab" id="tab-dashboard" onclick="showDashboard(); return false;">Dashboard</a>
      <a href="#" class="header-tab" id="tab-guide" onclick="showUserGuide(); return false;">User Guide</a>
    </div>

    <div class="header-right">
      <div class="wallet-info">
        <div class="wallet-top-row">
          <button id="themeToggle" class="theme-toggle">ðŸŒ™ Night</button>
          <button id="connectBtn">Connect Wallet</button>
          <div id="disconnectBtn" class="disconnect-icon" style="display:none;">
            <svg viewBox="0 0 24 24">
              <path d="M10 17l1.41-1.41L7.83 12l3.58-3.59L10 7l-5 5 5 5zm4-12h6v14h-6v2h8V3h-8v2z"/>
            </svg>
            <div class="disconnect-tooltip">Disconnect</div>
          </div>
        </div>

        <span id="walletAddress" class="mono"></span>
        <div class="small" id="networkInfo"></div>
      </div>
    </div>
  </header>

  <!-- DASHBOARD VIEW -->
  <div id="view-dashboard">
    <div class="three-col-grid">

      <!-- COLUMN 1 -->
      <div class="col-1">

        <!-- CREATE NEW LOCK -->
        <div class="card" id="card-create">
          <h2>Create New Lock</h2>
          <form id="createForm">
            <div class="form-row-h">
              <label>Lock Token</label>
              <select id="assetSelect">
                <option value="PLS">PLS (native)</option>
                <option value="PDAI">pDAI (token)</option>
                <option value="HEX">HEX (token)</option>
              </select>
            </div>

            <div class="form-row-h">
              <label>Target price ($)</label>
              <input id="targetPrice" type="text" placeholder="0.0100" required />
            </div>

            <div class="form-row-h">
              <label>Unlock Time</label>
              <input id="unlockDateTime" type="datetime-local" required />
              <button type="submit" id="createBtn" style="margin-left:12px;">Create Vault</button>
            </div>

            <div id="createStatus" class="small" style="margin-top:6px;"></div>
          </form>
        </div>

        <!-- ADD VAULT MANUALLY -->
        <div class="card">
          <h2>Add Vault Address Manually</h2>
          <div class="small">Paste any supported vault created by this factory.</div>

          <div style="display:flex; gap:8px; align-items:center; margin-top:6px;">
            <input id="manualVaultInput" type="text" placeholder="0x..." style="flex:1; min-width:200px;" />
            <button id="addVaultBtn">Add</button>

            <button id="restoreVaultsBtn"
              style="background:#1e40af; color:white; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:13px; white-space:nowrap;">
              Restore All Vaults
            </button>
          </div>

          <div id="manualAddStatus" class="small"></div>
        </div>

      </div>

      <!-- COLUMN 2 -->
      <div class="col-2">

        <!-- GLOBAL PRICE FEED -->
        <div class="card" id="card-pricefeed">
          <h2>Global Price Feed</h2>

          <div class="small" style="margin-bottom:6px;">
            Source: PulseX pools for the selected asset.<br>
            Uses primary (<b>1Â°</b>) & backup (<b>2Â°</b>) feeds.<br>
            Feeds chosen by USD-normalized liquidity.<br><br>
          </div>

          <div id="globalPrice"></div>
          <div id="globalPriceRaw" class="small"></div>
        </div>

      </div>

      <!-- COLUMN 3 -->
      <div class="col-3">

        <!-- ABOUT THIS APP -->
        <div class="card" id="card-about">
          <h2>About This App</h2>
          <div class="small">
            <ul style="margin:0; padding-left:18px;">
              <li>Immutable vaults for PLS, pDAI, or HEX. Unlocking via USD price threshold, or via time (backup)</li>
              <li>
                Verified Factory contract:
                <a href="https://otter.pulsechain.com/address/0xf6aDe1a6db5bD96aD782E7AA1F566D11166719F0/contract"
                   target="_blank" style="color:#3b82f6;">
                  see on Otter.pulsechain.com
                </a>
                <div style="margin-left:18px; margin-top:1px; font-size:12px; color:var(--subtext);">
                  Factory address = 0xf6aDe1a6db5bD96aD782E7AA1F566D11166719F0
                </div>
              </li>
              <li>
                GitHub repository:
                <a href="https://github.com/twingall1/Generic-Price-Time-Vault"
                   target="_blank" style="color:#3b82f6;">
                  github.com/twingall1/Generic-Price-Time-Vault
                </a>
              </li>
              <li>Feeds from PulseX pools, primary and backup.</li>
              <li>No admin keys; all logic on-chain.</li>
              <li>Time unlock as unbrickable failsafe.</li>
              <li>Factory registry enables vault restore.</li>
              <li>Intended as Single-use vaults.</li>
              <li>Rescue function for accidental 2nd deposits.</li>
            </ul>

            <div style="margin-top:6px; color:#facc15;">
              âš  0.5% fee on successful withdrawal.
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- YOUR LOCKS -->
    <div class="card">
      <h2>Your Locks</h2>
      <div id="locksContainer" class="small">Connect wallet to load.</div>
    </div>
  </div>

  <!-- USER GUIDE VIEW -->
  <div id="view-userguide" style="display:none;">
    <div class="card">
      <h1>PulseLocker â€“ User Guide</h1>

      <p>
        PulseLocker lets you create immutable single-use vaults for PLS, pDAI, or HEX.<br>
        Each vault unlocks when <strong>either</strong> a target USD price is met or a backup
        <strong>time unlock</strong> arrives.<br>
        Everything is fully on-chain with no admin keys.
      </p>

      <h2>1) Choose Asset Type</h2>
      <p>Select which token you want to lock.</p>

      <h2>2) Set Your Target USD Price</h2>
      <p>Enter the price that must be reached for the vault to unlock via price.</p>

      <h2>3) Set a Time Unlock (Backup)</h2>
      <p>Choose a date and time in the future.</p>

      <h2>4) Create the Vault</h2>
      <p>Connect your PulseChain wallet and click <strong>Create Vault</strong>.</p>

      <h2>5) Deposit Tokens</h2>
      <p>Send PLS / pDAI / HEX to the vault address whenever you want.</p>

      <h2>6) Unlock Conditions</h2>
      <ul>
        <li><strong>Target USD price met</strong>, OR</li>
        <li><strong>Time unlock reached</strong></li>
      </ul>

      <h2>7) Withdrawing</h2>
      <p>
        Once unlocked, click <strong>Withdraw</strong>.
        A 0.5% fee applies only on successful withdrawals.
      </p>

      <h2>8) Accidentally Sent More Funds?</h2>
      <p>Use the <strong>Rescue</strong> button after withdrawal.</p>

      <h2>9) Single-Use Design</h2>
      <ul>
        <li>Create</li>
        <li>Deposit</li>
        <li>Unlock</li>
        <li>Withdraw</li>
        <li>Rescue only</li>
      </ul>

      <p><a href="#" onclick="showDashboard(); return false;">Back to App</a></p>
    </div>
  </div>

  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="app.js"></script>

  <script>
    function showDashboard() {
      document.getElementById("view-dashboard").style.display = "block";
      document.getElementById("view-userguide").style.display = "none";
      document.getElementById("tab-dashboard").classList.add("active-header-tab");
      document.getElementById("tab-guide").classList.remove("active-header-tab");
    }

    function showUserGuide() {
      document.getElementById("view-dashboard").style.display = "none";
      document.getElementById("view-userguide").style.display = "block";
      document.getElementById("tab-dashboard").classList.remove("active-header-tab");
      document.getElementById("tab-guide").classList.add("active-header-tab");
    }

    showDashboard();
  </script>

</body>
</html>
